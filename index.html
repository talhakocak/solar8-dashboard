<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Solar8</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        * { box-sizing: border-box; }
        body {
            margin: 0; padding: 20px;
            height: 100vh; width: 100vw; 
            font-family: 'Inter', sans-serif;
            background: linear-gradient(90deg, #030015 0%, #21174B 100%);
            color: white;
            display: flex; gap: 20px;
            overflow: hidden; 
        }

        /* --- SOL PANEL --- */
        .sidebar { width: 28%; display: flex; flex-direction: column; gap: 20px; height: 100%; }

        .map-wrapper {
            flex: 60; position: relative; border-radius: 20px; overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); background: #111;
        }
        #map { width: 100%; height: 100%; }

        .weather-overlay { position: absolute; top: 15px; right: 15px; z-index: 1000; display: flex; gap: 8px; }
        .w-box { background: rgba(0,0,0,0.7); backdrop-filter: blur(8px); border: 1px solid rgba(255,255,255,0.15); border-radius: 10px; width: 50px; height: 60px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; }
        .wb-day { font-size: 9px; opacity: 0.9; font-weight: 700; margin-bottom: 3px;}
        .wb-icon { font-size: 16px; color: #FFC700; margin-bottom: 3px; }
        .wb-temp { font-size: 12px; font-weight: 800; }

        .panels-card {
            flex: 40; background: rgba(255,255,255,0.05); backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 20px;
            display: flex; flex-direction: column; overflow: hidden;
        }
        .panels-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; margin-bottom: 10px; }
        .ph-title { font-size: 12px; font-weight: 700; opacity: 0.8; text-transform: uppercase; letter-spacing: 0.5px;}
        .ph-badge { font-size: 10px; background: rgba(80, 205, 137, 0.2); color: #50CD89; padding: 4px 8px; border-radius: 6px; font-weight: 700; }
        
        .panel-list { display: flex; flex-direction: column; gap: 8px; overflow-y: auto; height: 100%; }
        .panel-list::-webkit-scrollbar { width: 0px; }
        .p-row { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.03); padding: 10px 12px; border-radius: 8px; }
        .p-info { display: flex; align-items: center; gap: 10px; }
        .p-name { font-size: 12px; font-weight: 500; opacity: 0.9; }
        .p-score { font-size: 13px; font-weight: 700; color: #50CD89; font-family: 'Courier New', monospace; }

        /* --- SAĞ PANEL --- */
        .main-content { width: 72%; display: flex; flex-direction: column; height: 100%; position: relative; }
        
        .header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; flex: 0 0 auto; z-index: 2000; }
        .header-text h1 { margin: 0; font-size: 24px; font-weight: 800; }
        .header-text p { margin: 0; opacity: 0.7; font-size: 12px; }

        /* BİLDİRİM */
        .notification-area { position: relative; }
        .bell-btn {
            background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.1);
            width: 40px; height: 40px; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; position: relative; transition: 0.2s;
        }
        .bell-icon { font-size: 18px; color: white; }
        .notif-badge {
            position: absolute; top: -5px; right: -5px; background: #F1416C; color: white;
            font-size: 10px; font-weight: 800; width: 18px; height: 18px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; border: 2px solid #030015; animation: pulse-red 2s infinite;
        }
        
        .dropdown {
            position: absolute; top: 50px; right: 0; width: 320px;
            background: rgba(18, 18, 30, 0.98); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6); padding: 15px;
            display: none; flex-direction: column; gap: 10px; z-index: 9999;
        }
        .dropdown.show { display: flex; }
        @keyframes slideDown { from { opacity: 0; transform: scale(0.95) translateY(-10px); } to { opacity: 1; transform: scale(1) translateY(0); } }

        .dd-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;}
        .dd-title { font-size: 12px; font-weight: 700; color: white; } .dd-clear { font-size: 10px; color: #50CD89; cursor: pointer; }
        
        .dd-item { display: flex; gap: 12px; align-items: flex-start; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.03); }
        .dd-icon-box { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 14px;}
        .dd-content { display: flex; flex-direction: column; gap: 4px; width: 100%; }
        .dd-msg { font-size: 12px; font-weight: 600; color: #e1e1e1; line-height: 1.3;} 
        .dd-time { font-size: 10px; opacity: 0.5; display: block; }
        .bg-danger { background: rgba(241, 65, 108, 0.2); color: #F1416C; } .bg-warn { background: rgba(255, 199, 0, 0.2); color: #FFC700; } .bg-info { background: rgba(0, 210, 255, 0.2); color: #00D2FF; }

        /* GRID */
        .grid { 
            flex: 1; display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            grid-template-rows: repeat(2, 1fr); 
            gap: 20px; 
        }

        .card {
            background: rgba(255,255,255,0.06); backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 20px;
            padding: 20px;
            display: flex; flex-direction: column; justify-content: space-between;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        .card-head { display: flex; justify-content: space-between; align-items: center; }
        .label-grp { display: flex; align-items: center; gap: 8px; }
        .c-icon { font-size: 20px; }
        .c-lbl { font-size: 13px; font-weight: 600; opacity: 0.8; text-transform: uppercase; white-space: nowrap; }
        
        .badge { padding: 5px 10px; border-radius: 6px; font-size: 11px; font-weight: 700; background: rgba(255,255,255,0.1); }
        .badge.green { color: #50CD89; background: rgba(80, 205, 137, 0.15); }
        .badge.purple { color: #bf7cf7; background: rgba(191, 124, 247, 0.15); }
        .badge.online { color: #50CD89; background: rgba(80, 205, 137, 0.15); display: flex; align-items: center; gap: 6px; }
        .blink-dot { width: 6px; height: 6px; background-color: #50CD89; border-radius: 50%; animation: blink-animation 1.5s infinite ease-in-out; }
        @keyframes blink-animation { 0% { opacity: 1; box-shadow: 0 0 0 0 rgba(80, 205, 137, 0.7); } 50% { opacity: 0.5; } 100% { opacity: 1; box-shadow: 0 0 0 4px rgba(80, 205, 137, 0); } }
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(241, 65, 108, 0.7); } 100% { box-shadow: 0 0 0 6px rgba(0,0,0,0); } }

        .val { font-size: 36px; font-weight: 800; line-height: 1; margin: auto 0; letter-spacing: -0.5px;}
        .unit { font-size: 16px; opacity: 0.5; margin-left: 4px; font-weight: 600; }
        .epdk-note { font-size: 9px; opacity: 0.4; font-weight: 400; margin-top: 5px; text-align: right; font-style: italic; }
        
        /* GRAFİK BÜYÜTME (FLEX-GROW İLE) */
        .chart-wrap { 
            width: 100%; 
            flex-grow: 1; /* Grafikler kutuyu doldurur */
            min-height: 0; 
            margin-top: 15px; 
            display: flex; align-items: flex-end;
        }
        .chart-wrap canvas { width: 100% !important; height: 100% !important; }

        .accent-y { color: #FFC700; } .accent-b { color: #009EF7; } .accent-r { color: #F1416C; } .accent-c { color: #00D2FF; } .accent-g { color: #50CD89; }
        .solar-pin { background: rgba(255, 199, 0, 0.9); border: 3px solid white; border-radius: 50%; box-shadow: 0 0 20px #FFC700; width: 18px; height: 18px; animation: pulse 2s infinite; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="map-wrapper">
            <div class="weather-overlay" id="weather-widget"><div class="w-box">...</div></div>
            <div id="map"></div>
        </div>
        <div class="panels-card">
            <div class="panels-header"><div class="ph-title">Dizi Performansı</div><div class="ph-badge">CANLI (3s)</div></div>
            <div class="panel-list" id="panel-container"></div>
        </div>
    </div>

    <div class="main-content">
        <div class="header">
            <div class="header-text"><h1>Solar8 Gösterge Paneli</h1><p>Canlı Veri Akışı • Teknopark İstanbul</p></div>
            
            <div class="notification-area">
                <div class="bell-btn" onclick="toggleDropdown()">
                    <i class="fa-regular fa-bell bell-icon"></i>
                    <div class="notif-badge" id="badge">3</div>
                </div>
                <div class="dropdown" id="dropdown">
                    <div class="dd-header"><span class="dd-title">Alarm Geçmişi</span><span class="dd-clear" onclick="clearNotifs()">Okundu Say</span></div>
                    <div class="dd-item"><div class="dd-icon-box bg-danger"><i class="fa-solid fa-triangle-exclamation"></i></div><div class="dd-content"><span class="dd-msg">İnverter #03 DC Hata (Kritik)</span><span class="dd-time">10 dk önce</span></div></div>
                    <div class="dd-item"><div class="dd-icon-box bg-warn"><i class="fa-solid fa-broom"></i></div><div class="dd-content"><span class="dd-msg">Panel #05 Temizlik Zamanı</span><span class="dd-time">2 saat önce</span></div></div>
                    <div class="dd-item"><div class="dd-icon-box bg-info"><i class="fa-solid fa-clipboard-check"></i></div><div class="dd-content"><span class="dd-msg">Günlük Rapor Hazırlandı</span><span class="dd-time">06:00</span></div></div>
                </div>
            </div>
        </div>

        <div class="grid">
            <div class="card"><div class="card-head"><div class="label-grp"><i class="fa-solid fa-bolt c-icon accent-y"></i><div class="c-lbl">Anlık Güç</div></div><span class="badge online"><div class="blink-dot"></div>Çevrimiçi</span></div><div class="val"><span id="pVal">112.4</span><span class="unit">kW</span></div></div>
            <div class="card"><div class="card-head"><div class="label-grp"><i class="fa-solid fa-sack-dollar c-icon accent-g"></i><div class="c-lbl">Bugün</div></div></div><div class="val"><span id="moneyVal">42.50</span><span class="unit">$</span></div><div class="epdk-note">* 2025 EPDK tarifesine göre</div></div>
            <div class="card"><div class="card-head"><div class="label-grp"><i class="fa-solid fa-chart-pie c-icon accent-b"></i><div class="c-lbl">Verimlilik</div></div><span class="badge purple">Yüksek</span></div><div class="val" id="efVal">%91.4</div></div>
            
            <div class="card"><div class="card-head"><div class="c-lbl">Işınım</div></div><div class="val" style="font-size:32px;" id="irVal">410 W/m²</div><div class="chart-wrap"><canvas id="cIr"></canvas></div></div>
            <div class="card"><div class="card-head"><div class="c-lbl">Modül Isısı</div></div><div class="val" style="font-size:32px;" id="mdVal">24.5 °C</div><div class="chart-wrap"><canvas id="cMd"></canvas></div></div>
            <div class="card"><div class="card-head"><div class="c-lbl">Nem</div></div><div class="val" style="font-size:32px;" id="hmVal">%65</div><div class="chart-wrap"><canvas id="cHm"></canvas></div></div>
        </div>
    </div>

    <script>
        function toggleDropdown() { document.getElementById('dropdown').classList.toggle('show'); }
        function clearNotifs() { document.getElementById('badge').style.display='none'; setTimeout(()=>{document.getElementById('dropdown').classList.remove('show');},300); }
        document.addEventListener('click', function(event) { if (!document.querySelector('.notification-area').contains(event.target)) { document.getElementById('dropdown').classList.remove('show'); } });

        const map = L.map('map', {zoomControl: false}).setView([40.930, 29.324], 14);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {maxZoom: 19}).addTo(map);
        const icon = L.divIcon({ className: 'solar-pin', iconSize: [18, 18] });
        L.marker([40.930, 29.324], { icon: icon }).addTo(map).bindPopup("<b>Teknopark GES</b>").openPopup();

        async function getWeather() { try {
            const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=40.93&longitude=29.32&daily=weathercode,temperature_2m_max&timezone=auto&forecast_days=3');
            const data = await res.json();
            let html = ''; const days = ['PAZ','PZT','SAL','ÇAR','PER','CUM','CMT'];
            const getIcon = (c) => (c===0)?'<i class="fa-solid fa-sun wb-icon"></i>':(c<4)?'<i class="fa-solid fa-cloud-sun wb-icon"></i>':'<i class="fa-solid fa-cloud-rain wb-icon" style="color:#00D2FF"></i>';
            data.daily.time.forEach((d, i) => { let day = (i===0)?'BUGÜN':days[new Date(d).getDay()]; html += `<div class="w-box"><span class="wb-day">${day}</span>${getIcon(data.daily.weathercode[i])}<span class="wb-temp">${Math.round(data.daily.temperature_2m_max[i])}°</span></div>`; });
            document.getElementById('weather-widget').innerHTML = html;
        } catch(e){} }
        getWeather();

        const panelContainer = document.getElementById('panel-container');
        let panels = []; for(let i=1; i<=7; i++) panels.push({ id: i, score: 88 + Math.random()*4 });
        function renderPanels() {
            let html = ''; let totalScore = 0;
            panels.forEach(p => { totalScore += p.score; let color = p.score > 90 ? '#50CD89' : '#FFC700'; html += `<div class="p-row"><div class="p-info"><span class="p-name">Dizi #${p.id}</span></div><span class="p-score" style="color:${color}">%${p.score.toFixed(2)}</span></div>`; });
            panelContainer.innerHTML = html;
            document.getElementById('efVal').innerText = "%" + (totalScore/panels.length).toFixed(1);
        }

        function chart(ctx, color, data) {
            let grad = ctx.createLinearGradient(0,0,0,400); 
            grad.addColorStop(0,color.replace('1)','0.6)')); grad.addColorStop(1,color.replace('1)','0)'));
            return new Chart(ctx, { 
                type:'line', 
                data:{labels:Array(20).fill(''),datasets:[{data:data,borderColor:color,backgroundColor:grad,borderWidth:3,tension:0.4,fill:true,pointRadius:0}]}, 
                options:{
                    responsive:true,
                    maintainAspectRatio:false, 
                    animation:false,
                    plugins:{legend:false},
                    scales:{x:{display:false},y:{display:true,position:'right',ticks:{color:'rgba(255,255,255,0.5)',font:{size:9},maxTicksLimit:3,precision:0},grid:{color:'rgba(255,255,255,0.05)',drawBorder:false}}},
                    layout:{padding:{left:-5,right:0,top:10,bottom:0}}
                } 
            });
        }
        
        // KIŞ MODU (ARALIK) - GÜNCEL VERİLER
        let dIr=Array(20).fill(410).map(()=>410+(Math.random()-0.5)*20);
        let dMd=Array(20).fill(24).map(()=>24+(Math.random()-0.5)*2);
        let dHm=Array(20).fill(65).map(()=>65+(Math.random()-0.5)*5);

        const c1=chart(document.getElementById('cIr').getContext('2d'),'rgba(255,199,0,1)',dIr);
        const c2=chart(document.getElementById('cMd').getContext('2d'),'rgba(241,65,108,1)',dMd);
        const c3=chart(document.getElementById('cHm').getContext('2d'),'rgba(0,210,255,1)',dHm);

        let p=112.4, money=42.50, ir=410, md=24.5, hm=65;

        setInterval(()=>{
            let r=(Math.random()-0.5); p+=r*4; ir+=r*15; if(ir>1000)ir=990; if(ir<200)ir=210; md+=(25+(ir/30)-md)*0.1; hm+=r; money += 0.01 + (Math.random() * 0.02);
            panels.forEach(pan => { let change = (Math.random() - 0.5) * 0.2; pan.score += change; if(pan.score > 92.0) pan.score = 91.9; if(pan.score < 88.0) pan.score = 88.1; });
            renderPanels();
            document.getElementById('pVal').innerText=p.toFixed(1); 
            document.getElementById('moneyVal').innerText = money.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('irVal').innerText=ir.toFixed(0)+" W/m²"; document.getElementById('mdVal').innerText=md.toFixed(1)+" °C"; document.getElementById('hmVal').innerText="%"+hm.toFixed(0);
            function up(c,v){ c.data.datasets[0].data.shift(); c.data.datasets[0].data.push(v); let min = Math.min(...c.data.datasets[0].data); let max = Math.max(...c.data.datasets[0].data); c.options.scales.y.min = Math.floor(min/5)*5; c.options.scales.y.max = Math.ceil(max/5)*5; c.update(); } 
            up(c1,ir); up(c2,md); up(c3,hm);
        }, 3000);
    </script>
</body>
</html>
